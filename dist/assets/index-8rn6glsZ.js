(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();class X{constructor(t,i,r){this.posX=t,this.posY=i,this.color=r,this.ocupado=!1}draw(t,i){t.strokeStyle="white",t.lineWidth=1,t.strokeRect(this.posX*i,this.posY*i,i,i)}static drawCasillas(t,i,r,s){t.forEach(o=>{s.fillStyle=o.color,s.fillRect(o.posX*i,o.posY*i,r,r)})}}function v(u){if(u.length===0)return null;const t=Math.floor(Math.random()*u.length);return u[t]}function e(u,t){return Math.floor(Math.random()*(t-u)+u)}class d{constructor(t,i,r,s,o){this.posX=t,this.posY=i,this.colum=r,this.filaRight=s,this.filaLeft=o,this.drop=["right","up","left","down"],this.inUse=!0}isFinish(t,i){if(this.posY+this.colum>=14)return!0;for(let r=0;r<i.length;r++){const s=i[r][0],o=i[r][1]+1;if(t.some(a=>a.posX==s&&a.posY==o))return!0}}obtenerCasillasDibujo(t){this.filaRight=0,this.filaLeft=0,this.colum=0;let i=[];return t.forEach(r=>{const s=r[0][0],o=r[0][1];if(this.drop[r[1]]=="right")for(let a=0;a<r[2];a++)i.push([s+a,o]),this.filaRight=a;else if(this.drop[r[1]]=="up")for(let a=0;a<r[2];a++)i.push([s,o-a]);else if(this.drop[r[1]]=="left")for(let a=0;a<r[2];a++)i.push([s-a,o]),this.filaLeft=a;else for(let a=0;a<r[2];a++)i.push([s,o+a]),this.colum=a}),i}drawCasillas(t,i,r,s,o){t.forEach(a=>{o.fillStyle=i,o.fillRect(a[0]*r,a[1]*r,s,s)})}update(t,i){this.posX+=t,this.posY+=i,this.posX+this.filaRight>=15&&(this.posX=14-this.filaRight),this.posX-this.filaLeft<=0&&(this.posX=0+this.filaLeft),this.posY+this.colum>=15&&(this.posY=14-this.colum)}}class m extends d{constructor(t,i,r,s,o){super(t,i,r,s,o),this.count=[0,0,0,3],this.dibujado=[[[t,i],this.count[0],3],[[t,i+1],this.count[1],3],[[t,i+2],this.count[2],3],[[t,i],this.count[3],3]]}update(t,i){super.update(t,i),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],3],[[this.posX,this.posY+1],this.count[1],3],[[this.posX,this.posY+2],this.count[2],3],[[this.posX,this.posY],this.count[3],3]]}rotarDibujo(){}}class x extends d{constructor(t,i,r,s,o){super(t,i,r,s,o),this.count=[3],this.dibujado=[[[t,i],this.count[0],5]]}update(t,i){super.update(t,i),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],5]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}class C extends d{constructor(t,i,r,s,o){super(t,i,r,s,o),this.count=[3,0,2],this.dibujado=[[[t,i],this.count[0],3],[[t,i],this.count[1],2],[[t,i],this.count[2],2]]}update(t,i){super.update(t,i),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],3],[[this.posX,this.posY],this.count[1],2],[[this.posX,this.posY],this.count[2],2]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}class P extends d{constructor(t,i,r,s,o){super(t,i,r,s,o),this.count=[3,2],this.dibujado=[[[t,i],this.count[0],2],[[t,i],this.count[1],2]]}update(t,i){super.update(t,i),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],2],[[this.posX,this.posY],this.count[1],2]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}class E extends d{constructor(t,i,r,s,o){super(t,i,r,s,o),this.count=[3,2],this.dibujado=[[[t,i],this.count[0],3],[[t,i],this.count[1],2]]}update(t,i){super.update(t,i),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],3],[[this.posX,this.posY],this.count[1],2]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}function w(u){const t=v(u);return t=="cuadrado"?new m(e(3,12),e(-5,0),2,2,0):t=="varilla"?new x(e(0,15),e(-5,0),4,0,0):t=="T"?new C(e(2,13),e(-5,0),2,1,1):t=="lPequena"?new P(e(2,13),e(-5,0),1,0,1):new E(e(2,13),e(-5,0),2,0,1)}function F(u,t){u.forEach(i=>{const r=i.posX,s=i.posY;t.some(o=>o[0]==r&&o[1]==s)&&(i.ocupado=!0)})}function L(u,t,i){return t.filter(s=>s.posY==u).length==15?(t=t.filter(s=>s.posY<u),i.forEach(s=>{t.some(o=>o.posY+1==s.posY&&o.posX==s.posX)?(s.color="blue",s.ocupado=!0):(s.ocupado=!1,s.color="green")}),!0):!1}const y=document.querySelector("canvas"),n=y.getContext("2d"),p=40,D=40;let f=0,b=0,j=1;y.width=600;y.height=600;let c=null,g=null;const Y=["cuadrado","varilla","T","lPequena","lGrande"];let h=[],l=[];for(let u=0;u<15;u++)for(let t=0;t<15;t++)h.push(new X(t,u,"green"));c=w(Y);g=w(Y);function q(u){switch(u.code){case"ArrowDown":b=1;break;case"ArrowLeft":f=-1;break;case"ArrowRight":f=1;break;case"Space":c.rotarDibujo();break}}document.addEventListener("keydown",q);function A(u){(u.key==="Escape"||u.keyCode===27)&&(j=j==0?1:0)}document.addEventListener("keydown",A);function z(){c.update(f,b),n.fillStyle="#242424",n.fillRect(0,0,600,600);const u=c.obtenerCasillasDibujo(c.dibujado);if(c.drawCasillas(u,"red",p,D,n),X.drawCasillas(l,p,D,n),h.forEach(t=>t.draw(n,p)),f=0,b=0,c.isFinish(l,u)){c=g,g=w(Y),F(h,u);let t=14;for(;t!=0;)l=h.filter(i=>i.ocupado),L(t,l,h)||t--;l=h.filter(i=>i.ocupado)}requestAnimationFrame(z)}z();setInterval(()=>c.update(0,j),2e3);
