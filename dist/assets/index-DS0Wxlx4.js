(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(s){if(s.ep)return;s.ep=!0;const e=i(s);fetch(s.href,e)}})();class E{constructor(t,i,o,s){this.posX=t,this.posY=i,this.color=o,this.ocupado=s}draw(t,i,o){t.strokeStyle="white",t.lineWidth=1,t.strokeRect(this.posX*i,this.posY*o,i,o)}static drawCasillas(t,i,o,s){t.forEach(e=>{s.fillStyle=e.color,s.fillRect(e.posX*i,e.posY*o,i,o)})}}function j(r){if(r.length===0)return null;const t=Math.floor(Math.random()*r.length);return r[t]}function c(r,t){return Math.floor(Math.random()*(t-r)+r)}class f{constructor(t,i,o,s,e){this.posX=t,this.posY=i,this.colum=o,this.filaRight=s,this.filaLeft=e,this.drop=["right","up","left","down"],this.inUse=!0}isFinish(t,i,o){if(this.posY+this.colum>=o-1)return!0;for(let s=0;s<i.length;s++){const e=i[s][0],a=i[s][1]+1;if(t.some(_=>_.posX==e&&_.posY==a))return!0}}obtenerCasillasDibujo(t){this.filaRight=0,this.filaLeft=0,this.colum=0;let i=[];return t.forEach(o=>{const s=o[0][0],e=o[0][1];if(this.drop[o[1]]=="right")for(let a=0;a<o[2];a++)i.push([s+a,e]),this.filaRight=a;else if(this.drop[o[1]]=="up")for(let a=0;a<o[2];a++)i.push([s,e-a]);else if(this.drop[o[1]]=="left")for(let a=0;a<o[2];a++)i.push([s-a,e]),this.filaLeft=a;else for(let a=0;a<o[2];a++)i.push([s,e+a]),this.colum=a}),i}drawCasillas(t,i,o,s,e){t.forEach(a=>{e.fillStyle=i,e.fillRect(a[0]*o,a[1]*s,o,s)})}update(t,i,o,s){this.posX+=t,this.posY+=i,this.posX+this.filaRight>=s-1&&(this.posX=s-1-this.filaRight),this.posX-this.filaLeft<=0&&(this.posX=0+this.filaLeft),this.posY+this.colum>=o-1&&(this.posY=o-1-this.colum)}}class g extends f{constructor(t,i,o,s,e){super(t,i,o,s,e),this.count=[0,0,0,3],this.dibujado=[[[t,i],this.count[0],3],[[t,i+1],this.count[1],3],[[t,i+2],this.count[2],3],[[t,i],this.count[3],3]]}update(t,i,o,s){super.update(t,i,o,s),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],3],[[this.posX,this.posY+1],this.count[1],3],[[this.posX,this.posY+2],this.count[2],3],[[this.posX,this.posY],this.count[3],3]]}rotarDibujo(){}}class M extends f{constructor(t,i,o,s,e){super(t,i,o,s,e),this.count=[3],this.dibujado=[[[t,i],this.count[0],5]]}update(t,i,o,s){super.update(t,i,o,s),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],5]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}class Y extends f{constructor(t,i,o,s,e){super(t,i,o,s,e),this.count=[3,0,2],this.dibujado=[[[t,i],this.count[0],3],[[t,i],this.count[1],2],[[t,i],this.count[2],2]]}update(t,i,o,s){super.update(t,i,o,s),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],3],[[this.posX,this.posY],this.count[1],2],[[this.posX,this.posY],this.count[2],2]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}class L extends f{constructor(t,i,o,s,e){super(t,i,o,s,e),this.count=[3,2],this.dibujado=[[[t,i],this.count[0],2],[[t,i],this.count[1],2]]}update(t,i,o,s){super.update(t,i,o,s),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],2],[[this.posX,this.posY],this.count[1],2]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}class X extends f{constructor(t,i,o,s,e){super(t,i,o,s,e),this.count=[3,2],this.dibujado=[[[t,i],this.count[0],3],[[t,i],this.count[1],2]]}update(t,i,o,s){super.update(t,i,o,s),this.actualizarDibujo()}actualizarDibujo(){this.dibujado=[[[this.posX,this.posY],this.count[0],3],[[this.posX,this.posY],this.count[1],2]]}rotarDibujo(){this.count=this.count.map(t=>(t++,t>3?0:t)),this.actualizarDibujo}}function A(r){const t=j(r);return t=="cuadrado"?new g(c(3,12),c(-5,0),2,2,0):t=="varilla"?new M(c(0,15),c(-5,0),4,0,0):t=="T"?new Y(c(2,13),c(-5,0),2,1,1):t=="lPequena"?new L(c(2,13),c(-5,0),1,0,1):new X(c(2,13),c(-5,0),2,0,1)}function w(r,t,i){return r.forEach(o=>{const s=o.posX,e=o.posY;t.some(a=>a[0]==s&&a[1]==e)&&i.push(new E(o.posX,o.posY,"green",!0))}),i}function G(r,t,i){let o=r-1;for(;o!=0;)t.filter(e=>e.posY==o).length==i?(t=t.filter(e=>e.posY!=o),console.log(t),t.forEach(e=>{e.posY<o&&(e.posY=e.posY+1)})):o--;return t}const n={velocidadX:0,velocidadY:0,velocidadYBajada:1};function v(r,t,i){switch(r.code){case"ArrowDown":t.velocidadY=1;break;case"ArrowLeft":t.velocidadX=-1;break;case"ArrowRight":t.velocidadX=1;break;case"Space":i.rotarDibujo();break}}function O(r,t){(r.key==="Escape"||r.keyCode===27)&&(t.velocidadYBajada=t.velocidadYBajada==0?1:0)}const u={CANVAS_DIMENSION_X:500,CANVAS_DIMENSION_Y:400,HEIGHT_GAME:18,WIDTH_GAME:16,DIMENSIONS_GRILLA_X:500/16,DIMENSIONS_GRILLA_Y:400/18};function b(r){const t=window.innerWidth,i=window.innerHeight;t<600?(r.CANVAS_DIMENSION_X=t-50,r.CANVAS_DIMENSION_Y=i-200,r.DIMENSIONS_GRILLA_X=r.CANVAS_DIMENSION_X/r.WIDTH_GAME,r.DIMENSIONS_GRILLA_Y=r.CANVAS_DIMENSION_Y/r.HEIGHT_GAME):(r.CANVAS_DIMENSION_X=400,r.CANVAS_DIMENSION_Y=400,r.DIMENSIONS_GRILLA_X=r.CANVAS_DIMENSION_X/r.WIDTH_GAME,r.DIMENSIONS_GRILLA_Y=r.CANVAS_DIMENSION_Y/r.HEIGHT_GAME)}const p=document.querySelector("canvas"),d=p.getContext("2d"),N=["cuadrado","varilla","T","lPequena","lGrande"];let h=A(N),D=A(N),I=[],l=[];for(let r=0;r<u.HEIGHT_GAME;r++)for(let t=0;t<u.WIDTH_GAME;t++)I.push(new E(t,r,"green",!1));document.addEventListener("keydown",r=>{v(r,n,h)});document.addEventListener("keydown",r=>{O(r,n)});document.getElementById("bt-d").addEventListener("click",()=>n.velocidadY=1);document.getElementById("bt-r").addEventListener("click",()=>n.velocidadX=1);document.getElementById("bt-l").addEventListener("click",()=>n.velocidadX=-1);document.getElementById("rotate").addEventListener("click",()=>h.rotarDibujo());b(u);window.addEventListener("resize",()=>b(u));function S(){p.width=u.CANVAS_DIMENSION_X,p.height=u.CANVAS_DIMENSION_Y,h.update(n.velocidadX,n.velocidadY,u.HEIGHT_GAME,u.WIDTH_GAME),d.fillStyle="black",d.fillRect(0,0,u.CANVAS_DIMENSION_X,u.CANVAS_DIMENSION_Y);const r=h.obtenerCasillasDibujo(h.dibujado);h.drawCasillas(r,"red",u.DIMENSIONS_GRILLA_X,u.DIMENSIONS_GRILLA_Y,d),E.drawCasillas(l,u.DIMENSIONS_GRILLA_X,u.DIMENSIONS_GRILLA_Y,d),I.forEach(t=>t.draw(d,u.DIMENSIONS_GRILLA_X,u.DIMENSIONS_GRILLA_Y)),n.velocidadX=0,n.velocidadY=0,h.isFinish(l,r,u.HEIGHT_GAME)&&(h=D,D=A(N),l=w(I,r,l),l=G(u.HEIGHT_GAME,l,u.WIDTH_GAME)),requestAnimationFrame(S)}S();setInterval(()=>h.update(0,n.velocidadYBajada,u.HEIGHT_GAME,u.WIDTH_GAME),1e3);
